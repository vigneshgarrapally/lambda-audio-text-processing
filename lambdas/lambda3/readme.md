# LLM Text Processing Lambda Function

## Description

This folder contains the code for the LLM Text Processing Lambda Function. This Lambda will take as its input some text to process, as well as system prompts provided by user. It will use LangChain (via a Layer) to call OpenAI ChatGPT for LLM text processing.Then it will return the ChatGPT response as text.

## Functionality

1. The function is triggered by an HTTP request, which includes the text to process and the prompts to use.
2. Supported API is OPEN AI ChatGPT.
3. The Lambda function will use the LangChain layer to call the OPEN AI ChatGPT API. It Creates a Prompt Template using provided prompt and text to process. Then it calls the OPEN AI ChatGPT API to process the text.
4. The Lambda function will return the response from the OPEN AI ChatGPT API as text.

## Deployment Steps

1. Create a new Lambda function in the AWS console.
2. Upload the code in this folder to the Lambda function.
3. Upload the [layer](./layers/langchain.zip) in the `layer` folder to the Lambda function and add it as a layer.
4. Make sure the Lambda function has access to the S3 bucket where the audio files are stored by adding the appropriate permissions to the execution role of the Lambda function. Sample Execution Role Policy can be found [here](./llmtextprocessing_executionpolicy.json).
5. Update the required environment variables and Resource Values in the Lambda function as shown in the [SAM template](./llm-text-processing.yaml).
6. Deploy the Lambda function
7. Test the Lambda function by sending an HTTP request to the API Gateway endpoint of the Lambda function. The request should include the text to which audio has to be generated and the name of the API to use for transcription. The response should include the Object URL of the audio file generated by the third party API.

## Environment Variables

The following environment variables are required for the Lambda function to work:

1. `OPENAI_API_KEY` : API Key for OpenAI ChatGPT API.

## Resource Values

Following are the values that need to be updated in the Lambda function. Feel free to change the values as per your requirements.

1. `MemorySize` : 128
2. `Timeout` : 123
3. `Runtime` : python3.10

## Test Example (Python)

```python
import boto3
import json

payload = {
    "body": json.dumps(
        {
            "text": "I want to start a company that makes cars.",
            "prompt": "Suggest a name for my company.",
        }
    )
}

client = boto3.client("lambda")
response = client.invoke(
    FunctionName="texttospeechlambda",
    InvocationType="RequestResponse",
    Payload=json.dumps(payload),
)
response = json.loads(response["Payload"].read())
print(response)
```
